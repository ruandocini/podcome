<!DOCTYPE html>

<html lang="pt-br">
    <head>
        <meta charset="utf-8">
        <script src="https://kit.fontawesome.com/a076d05399.js"></script>
        <link rel="stylesheet" href="https://indestructibletype.com/fonts/Jost.css" type="text/css" charset="utf-8" />
        <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Josefin+Sans" />
        <link rel="shortcut icon" href="imgs/logo.png">
        <meta charset="UTF-8">
        <title> Comer Melhor </title>
        <link rel="stylesheet" href="css/mapa.css">
        <link href="css/stylish-portfolio.css" rel="stylesheet">
        <script type="text/javascript" src="js/jquery-3.4.1.min.js"></script>
        <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDB0bW9wweKavZygNsWciNLzcrotfSQKh4 "> </script>
        <script type="text/javascript">
            var locations = [
            ];
            var icone = "";

            async function getAllRestaurants(restriction, map, icone){
                    var x = [];
                    api_call = 'http://localhost:8080/api/v1/restaurantes/restaurantes';
                    restriction = restriction || false;
                    data = await fetch(api_call)
                    .then(response => response.json())
                    .then(function(data){
                        for (counter=0; counter<data.length; counter++){
                            if (data[counter].restricao == restriction || restriction == false){
                            
                                const loc = {
                                    nome:data[counter].nome,
                                    lat:data[counter].latitude,
                                    long:data[counter].longitude,
                                    price:data[counter].preco,
                                    stars:data[counter].nota,
                                    temEntrega:data[counter].temEntrega,
                                    contato:data[counter].contato
                                };
                                x.push(loc);
                            }
                            initialize(x);
                        }
                    });  
                }

            function contentLoc(nome, preço, estrelas, entrega, contato){
                if(estrelas !== undefined){
                return nome + "<br/>" + "Faixa de preço: " + preço + "<br/>" + "Avaliação: "+ estrelas + " estrelas" + "<br/>" +  "Tem entrega: " + entrega + "<br/>" + "Contato: " + contato;
                }else{
                    return nome + "<br/> referencia: " + preço;
                }
            }

            function initialize(restaurants) {
                var mapOptions = {
                center: new google.maps.LatLng(-23.552559, -46.625561),
                zoom: 13,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                };
                var map = new google.maps.Map(document.getElementById("map_canvas"),
                    mapOptions);
                
                function carregarPontos(restaurants){
                    console.log(restaurants);

                    for (i = 0; i < restaurants.length; i++) {

                        var url = "";
                        var entregaParsed = "";

                        
                        url = 'http://maps.google.com/mapfiles/kml/shapes/convenience.png'
                        entregaParsed = "Não";
                        

                        var icon = {
                            url: url,
                            scaledSize: new google.maps.Size(40, 40), // scaled size
                            origin: new google.maps.Point(0,0), // origin
                            anchor: new google.maps.Point(0, 0) // anchor
                        };

                        marker = new google.maps.Marker({
                            position: new google.maps.LatLng(restaurants[i].lat, restaurants[i].long),
                            title: restaurants[i].nome,
                            map: map,
                            icon: icon
                        });

                        marker['infowindow'] = new google.maps.InfoWindow({
                            content: contentLoc(
                                restaurants[i].nome.bold(), 
                                restaurants[i].price, 
                                restaurants[i].stars,
                                entregaParsed,
                                restaurants[i].contato
                            )
                        });
                        google.maps.event.addListener(marker, 'mouseover', function() {
                            this['infowindow'].open(map, this);
                        });
                    }
                }
                carregarPontos(restaurants);
            }
            
        </script>
    </head>

    <body onload="initialize()">
        <div class="general-container">
            
            <div class="navbar"> 
                <a href="index.html"> <i class="fas fa-angle-left"></i> </a>
                <ul>
                    <li> <a href="index.html"> HOME </a></li>
                    <li> <a href="search.html"> SEARCH </a></li> 
                    <li> <a href="procura-pratos.html"> PRATOS </a></li> 
                    <li> <a href="login.html"> AREA DO RESTAURANTE </a></li> 
                </ul>
            </div>
            <div class="container"> 

                <h2 class="title">O que você está procurando? </h2>
                <a href="#" onclick="getAllRestaurants('feiras')"> 
                    <img src="imgs/laranja escuro.png" style="top: 200px;" class="pin"> 
                    <h3 style="top: 185px;" class="escrito"> Feiras livres </h3> 
                </a>
                <a href="#" onclick="getAllRestaurants('vegan')"> 
                    <img src="imgs/laranja claro.png" style="top: 280px;" class="pin">
                    <h3 style="top: 265px;" class="escrito"> Restaurantes veganos </h3>
                </a>
                <a href="#" onclick="getAllRestaurants('gluten')">
                    <img src="imgs/amarelo.png" style="top: 360px;" class="pin">
                    <h3 style="top: 345px;" class="escrito"> Para celíacos </h3>
                </a>
                <a href="#" onclick="getAllRestaurants('diabetes')">
                    <img src="imgs/verde claro.png" style="top: 440px;" class="pin">
                    <h3 style="top: 425px;" class="escrito"> Para diabéticos </h3>
                </a>
                <a href="#" onclick="getAllRestaurants('lactose')">
                    <img src="imgs/verde escuro.png" style="top: 520px;" class="pin">
                    <h3 style="top: 505px;" class="escrito"> Para intolerantes à lactose </h3>
                </a>

            </div>

        </div>
        
        <section id="contact" class="map">
            <div id="map_canvas" style="width:100%; height:100%;"></div>
        </section>
        <div>
            <p>As informações deste mapa foram retiradas de bancos de dados do governo de SP e do site TripAdvisor</p>
        </div>
    </body>
</html>
